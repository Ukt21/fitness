<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>FitCal AI ‚Äì Web App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <!-- TELEGRAM SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root {
      --primary: #7b4dff;
      --primary-soft: #efe7ff;
      --accent: #ff7bd1;
      --bg: #f7f6fb;
      --card: #ffffff;
      --text-main: #111827;
      --text-muted: #9ca3af;
      --border-soft: #e5e7eb;
      --radius-lg: 18px;
      --radius-xl: 24px;
      --shadow-soft: 0 16px 40px rgba(31, 41, 55, 0.08);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top left, #a855f7 0, #4f46e5 40%, #0f172a 100%);
      display: flex;
      justify-content: center;
      align-items: stretch;
      min-height: 100vh;
      color: var(--text-main);
    }

    .app-shell {
      background: var(--bg);
      width: 100%;
      max-width: 430px;
      min-height: 100vh;
      box-shadow: var(--shadow-soft);
      position: relative;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .app-header { padding: 16px 20px 8px; }

    .app-header-top {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 16px;
    }

    .back-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: none;
      background: rgba(148, 163, 184, 0.15);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .back-btn span { font-size: 16px; }

    .step-title { font-weight: 600; font-size: 18px; }

    .step-subtitle {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .progress-bar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 6px;
    }

    .progress-dot {
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .progress-dot.active { background: var(--primary); }

    .app-content {
      flex: 1;
      padding: 16px 20px 90px;
      overflow-y: auto;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-xl);
      padding: 18px 20px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.06);
    }

    .card + .card { margin-top: 16px; }

    .field-label {
      font-size: 16px;
      font-weight: 600;
      margin: 4px 0 16px;
      text-align: center;
    }

    .choice-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .choice {
      border-radius: var(--radius-lg);
      padding: 14px 16px;
      background: #f9fafb;
      border: 2px solid transparent;
      display: flex;
      align-items: center;
      justify-content: space-between;
      cursor: pointer;
      transition: 0.15s ease;
    }

    .choice-primary { font-weight: 600; }

    .choice-secondary {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .choice.selected {
      border-color: var(--primary);
      background: #f3e9ff;
      box-shadow: 0 0 0 1px rgba(124, 58, 237, 0.15);
    }

    .choice-icon {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: var(--primary-soft);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      color: var(--primary);
    }

    .slider-row { margin-top: 10px; }

    .slider-value {
      font-size: 22px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 12px;
    }

    .slider-input { width: 100%; }
    input[type="range"] { width: 100%; }

    .number-input {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin: 12px 0 4px;
    }

    .number-display {
      min-width: 140px;
      text-align: center;
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #f9fafb;
      font-size: 17px;
      font-weight: 500;
    }

    .n-btn {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: none;
      background: var(--primary-soft);
      color: var(--primary);
      font-size: 20px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .helper-text {
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
      margin-top: 6px;
    }

    /* Diary */

    .diary-header {
      text-align: center;
      color: #f9fafb;
      margin-bottom: 16px;
    }

    .diary-header h1 {
      margin: 4px 0 2px;
      font-size: 22px;
    }

    .diary-header span {
      font-size: 13px;
      opacity: 0.85;
    }

    .top-panel {
      background: linear-gradient(145deg, #8b5cf6, #ec4899);
      border-radius: 0 0 32px 32px;
      padding: 12px 20px 18px;
      color: #f9fafb;
      box-shadow: 0 16px 40px rgba(88, 28, 135, 0.35);
    }

    .ring-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 8px;
      gap: 12px;
    }

    .ring {
      width: 110px;
      height: 110px;
      border-radius: 999px;
      border: 10px solid rgba(249, 250, 251, 0.18);
      border-top-color: #fbbf24;
      border-right-color: #22c55e;
      border-left-color: #f97316;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, rgba(249, 250, 251, 0.28), transparent);
    }

    .ring-inner-value {
      text-align: center;
      font-weight: 600;
      font-size: 18px;
    }

    .ring-inner-value span {
      display: block;
      font-size: 11px;
      font-weight: 400;
      opacity: 0.85;
    }

    .macro-list { flex: 1; font-size: 13px; }

    .macro-item { margin-bottom: 8px; }

    .macro-head {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3px;
    }

    .macro-label { opacity: 0.9; }

    .macro-bar-bg {
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.25);
      overflow: hidden;
    }

    .macro-bar-fill { height: 100%; width: 0; border-radius: inherit; }

    .macro-bar-fill.protein { background: #22c55e; }
    .macro-bar-fill.fat { background: #f97316; }
    .macro-bar-fill.carb { background: #facc15; }

    .meals-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 18px;
    }

    .meal-card {
      background: var(--card);
      border-radius: 20px;
      padding: 12px 12px 10px;
      box-shadow: 0 8px 24px rgba(15, 23, 42, 0.06);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .meal-title { font-size: 14px; font-weight: 600; }
    .meal-kcal { font-size: 15px; font-weight: 600; margin-top: 4px; }
    .meal-target { font-size: 11px; color: var(--text-muted); }

    .meal-plus {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 15px;
    }

    .meal-illustration {
      position: absolute;
      bottom: -4px;
      right: 4px;
      opacity: 0.8;
      font-size: 26px;
    }

    .bottom-nav {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      padding: 8px 16px 14px;
      background: rgba(249, 250, 251, 0.98);
      backdrop-filter: blur(12px);
      box-shadow: 0 -6px 20px rgba(15, 23, 42, 0.06);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }

    .primary-btn {
      flex: 1;
      border-radius: 999px;
      border: none;
      padding: 14px 18px;
      background: var(--primary);
      color: white;
      font-weight: 600;
      font-size: 15px;
      cursor: pointer;
      display: inline-flex;
      justify-content: center;
      align-items: center;
      gap: 6px;
      box-shadow: 0 14px 30px rgba(88, 28, 135, 0.45);
    }

    .primary-btn:disabled {
      opacity: 0.4;
      box-shadow: none;
      cursor: default;
    }

    .secondary-inline {
      border-radius: 999px;
      border: none;
      padding: 10px 14px;
      background: transparent;
      color: var(--text-muted);
      font-size: 13px;
      cursor: pointer;
    }

    @media (max-width: 480px) {
      body { background: #0f172a; }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <div id="onboarding">
      <div class="app-header">
        <div class="app-header-top">
          <button class="back-btn" id="backBtn"><span>‚Äπ</span></button>
          <div>
            <div class="step-title" id="stepTitle">–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –ø–æ–ª</div>
            <div class="step-subtitle" id="stepSubtitle"></div>
          </div>
        </div>
        <div class="progress-bar" id="progressBar"></div>
      </div>
      <div class="app-content" id="stepContent"></div>
    </div>

    <div id="diary" style="display:none;">
      <div class="top-panel">
        <div class="diary-header">
          <div style="font-size:12px;opacity:.8;">–î–Ω–µ–≤–Ω–∏–∫</div>
          <h1>–°–µ–≥–æ–¥–Ω—è, 27 –Ω–æ—è–±—Ä—è</h1>
          <span>–°–ª–µ–¥–∏ –∑–∞ –ø—Ä–∏—ë–º–∞–º–∏ –ø–∏—â–∏ –∏ –≤–æ–¥–æ–π</span>
        </div>
        <div class="ring-row">
          <div class="ring">
            <div class="ring-inner-value">
              0
              <span>–∫–∫–∞–ª —Å—ä–µ–¥–µ–Ω–æ</span>
            </div>
          </div>
          <div class="macro-list">
            <div class="macro-item">
              <div class="macro-head">
                <span class="macro-label">–ë–µ–ª–∫–∏</span>
                <span>0 / 111 –≥</span>
              </div>
              <div class="macro-bar-bg">
                <div class="macro-bar-fill protein" style="width:0%"></div>
              </div>
            </div>
            <div class="macro-item">
              <div class="macro-head">
                <span class="macro-label">–ñ–∏—Ä—ã</span>
                <span>0 / 74 –≥</span>
              </div>
              <div class="macro-bar-bg">
                <div class="macro-bar-fill fat" style="width:0%"></div>
              </div>
            </div>
            <div class="macro-item">
              <div class="macro-head">
                <span class="macro-label">–£–≥–ª–µ–≤–æ–¥—ã</span>
                <span>0 / 277 –≥</span>
              </div>
              <div class="macro-bar-bg">
                <div class="macro-bar-fill carb" style="width:0%"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="app-content" style="padding-top:16px;">
        <div class="card">
          <div style="font-size:14px;font-weight:600;margin-bottom:12px;">–ü—Ä–∏—ë–º—ã –ø–∏—â–∏</div>
          <div class="meals-grid">
            <div class="meal-card">
              <div class="meal-plus">+</div>
              <div class="meal-title">–ó–∞–≤—Ç—Ä–∞–∫</div>
              <div class="meal-kcal">0 –∫–∫–∞–ª</div>
              <div class="meal-target">–∏–∑ 665 –∫–∫–∞–ª</div>
              <div class="meal-illustration">üç≥</div>
            </div>
            <div class="meal-card">
              <div class="meal-plus">+</div>
              <div class="meal-title">–ü–µ—Ä–µ–∫—É—Å</div>
              <div class="meal-kcal">0 –∫–∫–∞–ª</div>
              <div class="meal-target">–∏–∑ 222 –∫–∫–∞–ª</div>
              <div class="meal-illustration">üçä</div>
            </div>
            <div class="meal-card">
              <div class="meal-plus">+</div>
              <div class="meal-title">–û–±–µ–¥</div>
              <div class="meal-kcal">0 –∫–∫–∞–ª</div>
              <div class="meal-target">–∏–∑ 886 –∫–∫–∞–ª</div>
              <div class="meal-illustration">üç±</div>
            </div>
            <div class="meal-card">
              <div class="meal-plus">+</div>
              <div class="meal-title">–£–∂–∏–Ω</div>
              <div class="meal-kcal">0 –∫–∫–∞–ª</div>
              <div class="meal-target">–∏–∑ 442 –∫–∫–∞–ª</div>
              <div class="meal-illustration">üç§</div>
            </div>
          </div>
        </div>
      </div>

      <div class="bottom-nav" id="navDiary">
        <button class="secondary-inline" id="restartBtn">–°–±—Ä–æ—Å–∏—Ç—å –∞–Ω–∫–µ—Ç—É</button>
        <button class="primary-btn">
          <span>–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏—ë–º –ø–∏—â–∏</span> <span>Ôºã</span>
        </button>
      </div>
    </div>

    <!-- –Ω–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞; –≤ Telegram –∏—Å–ø–æ–ª—å–∑—É–µ–º MainButton -->
    <div class="bottom-nav" id="navOnboarding">
      <button class="secondary-inline" id="skipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      <button class="primary-btn" id="nextBtn">
        –î–∞–ª–µ–µ
      </button>
    </div>
  </div>

  <script>
    // TELEGRAM: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg) {
      tg.ready();
      tg.expand();
    }

    const state = {
      step: 0,
      gender: null,
      birthdate: null,
      height: 180,
      weightCurrent: 90,
      weightTarget: 75,
      experience: null,
      mealsPerDay: 4,
      goal: "lose",
    };

    const steps = [
      { id: "gender", title: "–£–∫–∞–∂–∏—Ç–µ –≤–∞—à –ø–æ–ª" },
      { id: "birthdate", title: "–ö–æ–≥–¥–∞ —É –≤–∞—Å –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è?" },
      { id: "height", title: "–í–∞—à —Ä–æ—Å—Ç" },
      { id: "weightCurrent", title: "–í–∞—à —Ç–µ–∫—É—â–∏–π –≤–µ—Å" },
      { id: "weightTarget", title: "–í–∞—à –∂–µ–ª–∞–µ–º—ã–π –≤–µ—Å" },
      { id: "mealsPerDay", title: "–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤—ã –æ–±—ã—á–Ω–æ –µ–¥–∏—Ç–µ?" },
      { id: "experience", title: "–ö–∞–∫–æ–π —É –≤–∞—Å –æ–ø—ã—Ç –≤ –ø–æ–¥—Å—á—ë—Ç–µ –∫–∞–ª–æ—Ä–∏–π?" },
    ];

    const stepContent = document.getElementById("stepContent");
    const stepTitle = document.getElementById("stepTitle");
    const stepSubtitle = document.getElementById("stepSubtitle");
    const progressBar = document.getElementById("progressBar");
    const nextBtn = document.getElementById("nextBtn");
    const backBtn = document.getElementById("backBtn");
    const skipBtn = document.getElementById("skipBtn");
    const navOnboarding = document.getElementById("navOnboarding");
    const onboarding = document.getElementById("onboarding");
    const diary = document.getElementById("diary");
    const restartBtn = document.getElementById("restartBtn");

    function renderProgress() {
      progressBar.innerHTML = "";
      for (let i = 0; i < steps.length; i++) {
        const dot = document.createElement("div");
        dot.className = "progress-dot" + (i <= state.step ? " active" : "");
        progressBar.appendChild(dot);
      }
    }

    function setSubtitle(text) {
      stepSubtitle.textContent = text || "";
    }

    // TELEGRAM: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ MainButton
    function updateMainButton(disabledText) {
      if (!tg) return;

      if (state.step === steps.length - 1) {
        tg.MainButton.setText("–ù–∞—á–∞—Ç—å");
      } else {
        tg.MainButton.setText("–î–∞–ª–µ–µ");
      }

      if (disabledText) {
        tg.MainButton.disable();
      } else {
        tg.MainButton.enable();
      }

      tg.MainButton.show();
    }

    function renderStep() {
      const step = steps[state.step];
      stepTitle.textContent = step.title;
      renderProgress();
      nextBtn.disabled = false;
      skipBtn.style.display = "inline-flex";

      let needDisable = false;

      switch (step.id) {
        case "gender":
          setSubtitle("–î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Ç–æ—á–Ω—ã—Ö —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π –ø–æ –ø–∏—Ç–∞–Ω–∏—é.");
          stepContent.innerHTML = `
          <div class="card">
            <div class="field-label">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</div>
            <div class="choice-list">
              <div class="choice" data-gender="female">
                <div>
                  <div class="choice-primary">–ñ–µ–Ω—Å–∫–∏–π</div>
                  <div class="choice-secondary">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–æ—Ä–º–∞ –∫–∞–ª–æ—Ä–∏–π –±—É–¥–µ—Ç –Ω–∏–∂–µ</div>
                </div>
                <div class="choice-icon">‚ôÄ</div>
              </div>
              <div class="choice" data-gender="male">
                <div>
                  <div class="choice-primary">–ú—É–∂—Å–∫–æ–π</div>
                  <div class="choice-secondary">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–æ—Ä–º–∞ –∫–∞–ª–æ—Ä–∏–π –±—É–¥–µ—Ç –≤—ã—à–µ</div>
                </div>
                <div class="choice-icon">‚ôÇ</div>
              </div>
            </div>
          </div>`;
          const genderChoices = stepContent.querySelectorAll(".choice");
          genderChoices.forEach((el) => {
            el.addEventListener("click", () => {
              genderChoices.forEach((c) => c.classList.remove("selected"));
              el.classList.add("selected");
              state.gender = el.dataset.gender;
              if (tg) updateMainButton(false);
              nextBtn.disabled = false;
            });
          });
          if (state.gender) {
            const el = stepContent.querySelector(
              '.choice[data-gender="' + state.gender + '"]'
            );
            if (el) el.classList.add("selected");
          } else {
            needDisable = true;
          }
          break;

        case "birthdate":
          setSubtitle("–ß—Ç–æ–±—ã —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –≤–æ–∑—Ä–∞—Å—Ç –∏ –±–∞–∑–æ–≤—ã–π –æ–±–º–µ–Ω –≤–µ—â–µ—Å—Ç–≤.");
          stepContent.innerHTML = `
          <div class="card">
            <div class="field-label">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è</div>
            <input type="date" id="birthInput" style="width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border-soft);font-size:15px;">
            <div class="helper-text">–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∏–≥–¥–µ –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è.</div>
          </div>`;
          const birthInput = document.getElementById("birthInput");
          if (state.birthdate) birthInput.value = state.birthdate;
          birthInput.addEventListener("input", () => {
            state.birthdate = birthInput.value;
            const empty = !state.birthdate;
            nextBtn.disabled = empty;
            if (tg) updateMainButton(empty);
          });
          needDisable = !state.birthdate;
          break;

        case "height":
          setSubtitle("–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –∏–Ω–¥–µ–∫—Å–∞ –º–∞—Å—Å—ã —Ç–µ–ª–∞.");
          stepContent.innerHTML = `
          <div class="card">
            <div class="field-label">–í–∞—à —Ä–æ—Å—Ç</div>
            <div class="number-input">
              <button class="n-btn" id="hMinus">‚àí</button>
              <div class="number-display" id="hDisplay">${state.height} —Å–º</div>
              <button class="n-btn" id="hPlus">+</button>
            </div>
            <div class="helper-text">–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∑–∂–µ –≤ –ø—Ä–æ—Ñ–∏–ª–µ.</div>
          </div>`;
          const hDisp = document.getElementById("hDisplay");
          document.getElementById("hMinus").onclick = () => {
            state.height = Math.max(140, state.height - 1);
            hDisp.textContent = state.height + " —Å–º";
          };
          document.getElementById("hPlus").onclick = () => {
            state.height = Math.min(220, state.height + 1);
            hDisp.textContent = state.height + " —Å–º";
          };
          break;

        case "weightCurrent":
          setSubtitle("");
          renderWeightStep("current");
          break;

        case "weightTarget":
          setSubtitle("");
          renderWeightStep("target");
          break;

        case "mealsPerDay":
          setSubtitle("–ú–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∑–∂–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö.");
          stepContent.innerHTML = `
          <div class="card">
            <div class="field-label">–°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤—ã –æ–±—ã—á–Ω–æ –µ–¥–∏—Ç–µ?</div>
            <div class="slider-row">
              <div class="slider-value" id="mealsValue">${state.mealsPerDay}</div>
              <input class="slider-input" type="range" min="2" max="6" step="1" id="mealsSlider">
            </div>
            <div class="helper-text">–†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞–ª–æ—Ä–∏–π –ø–æ–º–æ–∂–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —ç–Ω–µ—Ä–≥–∏—é –≤ —Ç–µ—á–µ–Ω–∏–µ –¥–Ω—è.</div>
          </div>`;
          const mealsSlider = document.getElementById("mealsSlider");
          const mealsValue = document.getElementById("mealsValue");
          mealsSlider.value = state.mealsPerDay;
          mealsSlider.oninput = () => {
            state.mealsPerDay = Number(mealsSlider.value);
            mealsValue.textContent = state.mealsPerDay;
          };
          break;

        case "experience":
          setSubtitle("–ß—Ç–æ–±—ã –ø–æ–¥–æ–±—Ä–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏ –ø–æ–¥—Å–∫–∞–∑–æ–∫.");
          stepContent.innerHTML = `
          <div class="card">
            <div class="field-label">–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å</div>
            <div class="choice-list">
              <div class="choice" data-exp="newbie">
                <div>
                  <div class="choice-primary">–ù–æ–≤–∏—á–æ–∫</div>
                  <div class="choice-secondary">–ù–µ –±—ã–ª–æ –æ–ø—ã—Ç–∞ —Ä–∞–Ω–µ–µ</div>
                </div>
              </div>
              <div class="choice" data-exp="basic">
                <div>
                  <div class="choice-primary">–ó–Ω–∞—é –æ—Å–Ω–æ–≤—ã</div>
                  <div class="choice-secondary">–ë—ã–ª –æ–ø—ã—Ç, –Ω–æ –±–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç–∏</div>
                </div>
              </div>
              <div class="choice" data-exp="pro">
                <div>
                  <div class="choice-primary">–û–ø—ã—Ç–Ω—ã–π</div>
                  <div class="choice-secondary">–£–º–µ—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø–∏—Ç–∞–Ω–∏–µ –∏ —Å—á–∏—Ç–∞—Ç—å –∫–∞–ª–æ—Ä–∏–∏</div>
                </div>
              </div>
            </div>
          </div>`;
          const expChoices = stepContent.querySelectorAll(".choice");
          expChoices.forEach((el) => {
            el.addEventListener("click", () => {
              expChoices.forEach((c) => c.classList.remove("selected"));
              el.classList.add("selected");
              state.experience = el.dataset.exp;
              if (tg) updateMainButton(false);
              nextBtn.disabled = false;
            });
          });
          if (state.experience) {
            const el = stepContent.querySelector(
              '.choice[data-exp="' + state.experience + '"]'
            );
            if (el) el.classList.add("selected");
          } else {
            needDisable = true;
          }
          break;
      }

      backBtn.style.visibility = state.step === 0 ? "hidden" : "visible";
      nextBtn.textContent = state.step === steps.length - 1 ? "–ù–∞—á–∞—Ç—å" : "–î–∞–ª–µ–µ";

      if (needDisable) {
        nextBtn.disabled = true;
      }

      // –≤ Telegram —É–ø—Ä–∞–≤–ª—è–µ–º MainButton, –∞ –Ω–∏–∂–Ω—é—é –ø–∞–Ω–µ–ª—å —Å–∫—Ä—ã–≤–∞–µ–º
      if (tg) {
        navOnboarding.style.display = "none";
        updateMainButton(needDisable);
        tg.BackButton[state.step === 0 ? "hide" : "show"]();
      } else {
        navOnboarding.style.display = "flex";
      }
    }

    function renderWeightStep(type) {
      const isCurrent = type === "current";
      const weight = isCurrent ? state.weightCurrent : state.weightTarget;
      const label = isCurrent ? "–í–∞—à —Ç–µ–∫—É—â–∏–π –≤–µ—Å" : "–í–∞—à –∂–µ–ª–∞–µ–º—ã–π –≤–µ—Å";

      stepContent.innerHTML = `
        <div class="card">
          <div class="field-label">${label}</div>
          <div class="number-input">
            <button class="n-btn" id="wMinus">‚àí</button>
            <div class="number-display" id="wDisplay">${weight.toFixed(1)} –∫–≥</div>
            <button class="n-btn" id="wPlus">+</button>
          </div>
          <div class="helper-text">–î–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ –¥–Ω–µ–≤–Ω–æ–π –Ω–æ—Ä–º—ã –∫–∞–ª–æ—Ä–∏–π.</div>
        </div>`;

      const wDisp = document.getElementById("wDisplay");
      document.getElementById("wMinus").onclick = () => {
        const step = 0.5;
        if (isCurrent) {
          state.weightCurrent = Math.max(40, state.weightCurrent - step);
          wDisp.textContent = state.weightCurrent.toFixed(1) + " –∫–≥";
        } else {
          state.weightTarget = Math.max(40, state.weightTarget - step);
          wDisp.textContent = state.weightTarget.toFixed(1) + " –∫–≥";
        }
      };
      document.getElementById("wPlus").onclick = () => {
        const step = 0.5;
        if (isCurrent) {
          state.weightCurrent = Math.min(200, state.weightCurrent + step);
          wDisp.textContent = state.weightCurrent.toFixed(1) + " –∫–≥";
        } else {
          state.weightTarget = Math.min(200, state.weightTarget + step);
          wDisp.textContent = state.weightTarget.toFixed(1) + " –∫–≥";
        }
      };
    }

    function goNext() {
      if (state.step < steps.length - 1) {
        state.step++;
        renderStep();
      } else {
        // –∫–æ–Ω–µ—Ü –∞–Ω–∫–µ—Ç—ã
        if (tg) {
          // –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
          const payload = {
            type: "onboarding_complete",
            data: state,
          };
          tg.sendData(JSON.stringify(payload));
          tg.close();
        } else {
          // –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä ‚Äì –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–Ω–µ–≤–Ω–∏–∫
          onboarding.style.display = "none";
          navOnboarding.style.display = "none";
          diary.style.display = "block";
        }
      }
    }

    function goBack() {
      if (state.step > 0) {
        state.step--;
        renderStep();
      }
    }

    function resetFlow() {
      state.step = 0;
      onboarding.style.display = "block";
      navOnboarding.style.display = tg ? "none" : "flex";
      diary.style.display = "none";
      renderStep();
    }

    nextBtn.addEventListener("click", goNext);
    backBtn.addEventListener("click", goBack);
    skipBtn.addEventListener("click", goNext);
    restartBtn.addEventListener("click", resetFlow);

    // TELEGRAM: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ MainButton –∏ BackButton
    if (tg) {
      tg.onEvent("mainButtonClicked", goNext);
      tg.onEvent("backButtonClicked", goBack);
    }

    // init
    renderStep();
  </script>
</body>
</html>
